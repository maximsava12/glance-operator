apiVersion: kuttl.dev/v1beta1
kind: TestStep
commands:
  - script: |
      oc kustomize ../../../../config/samples/layout/single | oc apply -n $NAMESPACE -f -
  - script: |
      oc kustomize ../../../../config/samples/disk_formats | oc apply -n $NAMESPACE -f -
---
# Verify if disk formats is configured
apiVersion: kuttl.dev/v1beta1
kind: TestAssert
namespaced: true
commands:
  - script: |
      template='{{.spec.customServiceConfig}}'
      regex=regex="disk_formats"
      disk_formats=$(oc get -n $NAMESPACE Glance glance -o go-template="$template")
      matches=$(echo $disk_formats | sed 's/.*disk_formats=\([^ ]*\).*/\1/')
      if [ -z "$matches" ]; then
        exit 0
      else
        exit 1
      fi
